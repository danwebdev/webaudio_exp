function init(){console.log("in init");try{ctx=new webkitAudioContext;src=ctx.createBufferSource();setupCanvas();initSC()}catch(e){alert("you need webaudio support"+e)}}function initSC(){function r(t){n=t;e.empty();for(var r=0;r<n.length;r++){var i=n[r],s=$("<img>").attr("src",i.artwork_url),o=$("<p>").text(i.title),u=$("<li>").append(s).append(o);e.append(u);var a=u.data("idx",r)}}var e=$("#tracklist");SC.initialize({client_id:"7dba0507b27063e9f49168e856f7e09e"});var t;$("#SCsearch").keyup(function(e){t=$(e.target);SC.get("/tracks",{q:t.val()},r)});var n;$("#tracklist").on("click","li",function(e){var t=$(e.currentTarget).data("idx"),r=n[t].stream_url;console.log(r);loadFileWithStramUrl(r);console.log(n[t])});loadFileWithStramUrl("https://api.soundcloud.com/tracks/12303577/stream")}function loadFileWithStramUrl(e){var t=new XMLHttpRequest;t.open("GET",e+"?client_id=7dba0507b27063e9f49168e856f7e09e",!0);t.responseType="arraybuffer";t.onload=function(){ctx.activeSourceCount>0&&src.stop();ctx.decodeAudioData(t.response,function(e){buf=e;play()})};t.send()}function play(){src.buffer=buf;fft=ctx.createAnalyser();fft.fftSize=samples;src.connect(fft);fft.connect(ctx.destination);src.start(0);setup=!0}function setupCanvas(){canvas=document.getElementById("paper");sizeCanvas();gfx=canvas.getContext("2d");webkitRequestAnimationFrame(update)}function sizeCanvas(){canvas.width=$(window).width();w=canvas.width;h=canvas.height}function update(){var e=14;webkitRequestAnimationFrame(update);if(!setup)return;gfx.clearRect(0,0,w,h);gfx.fillStyle="#070c15";gfx.fillRect(0,0,w,h);var t=new Uint8Array(samples);fft.getByteFrequencyData(t);var n=gfx.createLinearGradient(0,e,0,h-2*e);n.addColorStop(0,"#fa2b30");n.addColorStop(.2,"#0e5dc3");n.addColorStop(.7,"#75f86f");n.addColorStop(1,"#75f86f");for(var r=0;r<t.length;r++){gfx.fillStyle=n;gfx.fillRect(4+r*7,h-t[r]/255*(h-2*e)-e,6,1);if(r%20!==0)continue;var i=Math.floor(ctx.sampleRate/fft.fftSize*r+1)/1e3;gfx.font="7px sans-serif";gfx.textBaseline="bottom";gfx.fillStyle="#56607b";gfx.fillText(i,4+r*7,h-2)}}var ctx,buf,fft,samples=1024,setup=!1;window.addEventListener("load",init,!1);var gfx;$(window).on("resize",function(e){sizeCanvas()});